<?xml version="1.0" encoding="UTF-8"?>
<bpmn2:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.omg.org/bpmn20" xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:bpsim="http://www.bpsim.org/schemas/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:drools="http://www.jboss.org/drools" id="_hYeVsEyLEeeV8cTQ3i7u3Q" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd http://www.jboss.org/drools drools.xsd http://www.bpsim.org/schemas/1.0 bpsim.xsd" exporter="jBPM Designer" exporterVersion="6.2.0" expressionLanguage="http://www.mvel.org/2.0" targetNamespace="http://www.omg.org/bpmn20" typeLanguage="http://www.java.com/javaTypes">
  <bpmn2:itemDefinition id="processInstanceId" structureRef="String"/>
  <bpmn2:itemDefinition id="ref_ProcessInstanceId" structureRef="String"/>

  <bpmn2:process id="org.jbpm.test.functional.workitem.Signal-Action" drools:packageName="org.jbpm" drools:version="1.0" name="org.jbpm.test.functional.workitem.Signal-Action" isExecutable="true">
    <bpmn2:property id="OtherProcessInstanceId" itemSubjectRef="ref_ProcessInstanceId"/>
    <bpmn2:startEvent id="_0DB24A12-57DD-49DA-9E00-F3BB17EA56B1" drools:selectable="true" color:background-color="#9acd32" color:border-color="#000000" color:color="#000000" name="">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:outgoing>_0C3463C0-04FA-4934-8E35-925F77E6BA4E</bpmn2:outgoing>
    </bpmn2:startEvent>

	<bpmn2:sequenceFlow id="_0C3463C0-04FA-4934-8E35-925F77E6BA4E" drools:selectable="true" color:background-color="#000000" color:border-color="#000000" color:color="#000000" sourceRef="_0DB24A12-57DD-49DA-9E00-F3BB17EA56B1" targetRef="_C34F6DDB-E743-4CB0-94F2-3855FC912275"/>

    <bpmn2:scriptTask id="_C34F6DDB-E743-4CB0-94F2-3855FC912275" name="Script Task 2" scriptFormat="http://www.java.com/java">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[SampleUserWorkitem]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>_0C3463C0-04FA-4934-8E35-925F77E6BA4E</bpmn2:incoming>
      <bpmn2:outgoing>_A6F80F6A-79A9-4D75-B1FE-5C878E4C5E34</bpmn2:outgoing>
         <bpmn2:script>
	        org.kie.api.executor.ExecutorService executorService = (org.kie.api.executor.ExecutorService) kcontext.getKieRuntime().getEnvironment().get("ExecutorService");
	        String ppid = (String) context.getVariable("OtherProcessInstanceId");
	        org.kie.api.executor.CommandContext ctx = new org.kie.api.executor.CommandContext();
	        ctx.setData("deploymentId", (String) kcontext.getKieRuntime().getEnvironment().get("deploymentId"));
	        ctx.setData("processInstanceId", Long.parseLong(ppid));
	        ctx.setData("Signal", "commonSignal");
	        ctx.setData("Event", null);
	        
	        executorService.scheduleRequest(org.jbpm.process.core.async.AsyncSignalEventCommand.class.getName(), ctx);
	     </bpmn2:script>
    </bpmn2:scriptTask>

    <bpmn2:sequenceFlow id="_A6F80F6A-79A9-4D75-B1FE-5C878E4C5E34" drools:selectable="true" color:background-color="#000000" color:border-color="#000000" color:color="#000000" sourceRef="_C34F6DDB-E743-4CB0-94F2-3855FC912275" targetRef="_A1B9C857-B8DD-4194-9FCF-FE1C614EB6F4"/>
    
    <bpmn2:endEvent id="_A1B9C857-B8DD-4194-9FCF-FE1C614EB6F4" drools:selectable="true" color:background-color="#ff6347" color:border-color="#000000" color:color="#000000" name="">
      <bpmn2:extensionElements>
        <drools:metaData name="elementname">
          <drools:metaValue><![CDATA[]]></drools:metaValue>
        </drools:metaData>
      </bpmn2:extensionElements>
      <bpmn2:incoming>_A6F80F6A-79A9-4D75-B1FE-5C878E4C5E34</bpmn2:incoming>
    </bpmn2:endEvent>

  </bpmn2:process>
</bpmn2:definitions>
